# 2233recorder - Linux直播录播软件设计思路

## 1. 软件概述

2233recorder是一款基于Linux系统（Ubuntu 24.04/Debian等）开发的直播自动录制软件，支持B站等主流直播平台。该软件设计灵感来源于[临明小狐狸](https://github.com/Linming-XHL/bilibili-live-31513824)的GitHub Actions自动化录播工作流，旨在提供一个本地可部署、高度可配置、具有可视化管理界面的直播录制解决方案。

## 2. 系统架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                     2233recorder                        │
├─────────────┬─────────────┬─────────────┬─────────────┤
│  监控模块   │  录制模块   │  处理模块   │  管理模块   │
├─────────────┼─────────────┼─────────────┼─────────────┤
│  直播平台API │  录播姬核心 │  FFmpeg处理  │  Web后台    │
└─────────────┴─────────────┴─────────────┴─────────────┘
        │           │           │           │
        └───────────┴───────────┴───────────┘
                    配置文件系统
```

### 2.2 核心组件

1. **监控模块**：定时检查直播间状态，支持多种直播平台
2. **录制模块**：基于成熟的录播姬技术，负责实际的直播流录制
3. **处理模块**：使用FFmpeg进行视频处理，如添加水印、格式转换等
4. **管理模块**：提供Web可视化界面，方便用户配置和管理录制任务

## 3. 核心功能模块

### 3.1 监控模块

**功能**：
- 定时检查指定直播间的在线状态
- 支持多平台（B站、斗鱼、虎牙等）
- 支持多房间同时监控
- 开播自动触发录制
- 下播自动停止录制

**实现思路**：
- 使用cron或系统服务定时执行监控任务
- 通过各平台API获取直播状态
- 支持自定义监控频率
- 异常情况通知（邮件、Webhook等）

### 3.2 录制模块

**功能**：
- 自动下载并更新录播姬
- 支持多房间同时录制
- 自动管理录制文件
- 录制状态实时监控

**实现思路**：
- 基于开源录播姬项目（如BililiveRecorder）
- 动态配置录制参数
- 录制过程日志记录
- 异常情况自动恢复

### 3.3 处理模块

**功能**：
- 视频格式转换（FLV→MP4）
- 自定义水印添加
- 视频剪辑和合并
- 视频压缩和优化

**实现思路**：
- 使用FFmpeg进行视频处理
- 支持自定义处理脚本
- 处理任务队列管理
- 处理结果通知

### 3.4 管理模块

**功能**：
- 可视化配置界面
- 录制任务管理
- 录制历史查看
- 系统状态监控
- 用户权限管理

**实现思路**：
- 基于Web技术（HTML+CSS+JavaScript）
- 后端使用轻量级框架（如Flask、FastAPI）
- 响应式设计，支持移动端访问
- RESTful API设计，方便扩展

## 4. 配置文件设计

### 4.1 主配置文件（config.yaml）

```yaml
# 2233recorder 主配置文件

# 系统配置
system:
  name: "2233recorder"
  version: "1.0.0"
  log_level: "info"  # debug, info, warning, error
  temp_dir: "/tmp/2233recorder"
  data_dir: "/opt/2233recorder/data"
  log_dir: "/opt/2233recorder/logs"

# 监控配置
monitor:
  enabled: true
  interval: 300  # 监控间隔（秒）
  platforms:  # 支持的平台列表
    - "bilibili"
    - "douyu"
    - "huya"

# 录制配置
recorder:
  enabled: true
  auto_update: true  # 自动更新录播姬
  default_output_format: "mp4"
  recorders:
    bilibili:
      type: "bililive_recorder"
      download_url: "https://github.com/BililiveRecorder/BililiveRecorder/releases/latest"
      work_dir: "/opt/2233recorder/recorders/bilibili"

# 处理配置
processor:
  enabled: true
  ffmpeg_path: "/usr/bin/ffmpeg"
  watermark:
    enabled: true
    text: "2233recorder录制"
    font: "wqy-microhei"
    font_size: 24
    color: "white"
    position: "bottom-right"
    margin: 10

# Web管理配置
web:
  enabled: true
  host: "0.0.0.0"
  port: 8080
  username: "admin"
  password: "admin123"  # 建议首次登录后修改
  ssl:
    enabled: false
    cert_file: ""
    key_file: ""
```

### 4.2 房间配置文件（rooms.yaml）

```yaml
# 直播间配置列表

rooms:
  - id: "1"
    platform: "bilibili"
    room_id: "123456"  # B站房间号
    name: "主播名称"
    auto_record: true
    output_dir: "/opt/2233recorder/recordings/bilibili/123456"
    watermark:  # 房间级水印配置，覆盖全局配置
      enabled: true
      text: "主播名称 - 由2233recorder录制"
    processor:  # 房间级处理配置
      enabled: true
      format: "mp4"
      compress: true
      quality: "high"

  - id: "2"
    platform: "douyu"
    room_id: "789012"  # 斗鱼房间号
    name: "另一位主播"
    auto_record: true
    output_dir: "/opt/2233recorder/recordings/douyu/789012"
    watermark:
      enabled: false
```

## 5. 可视化后台设计

### 5.1 界面结构

1. **首页**：
   - 系统状态概览
   - 实时录制状态
   - 近期录制任务
   - 系统资源使用情况

2. **房间管理**：
   - 房间列表
   - 添加/编辑/删除房间
   - 房间状态实时监控
   - 批量操作

3. **录制管理**：
   - 录制任务列表
   - 开始/停止录制
   - 录制历史记录
   - 录制文件管理

4. **配置中心**：
   - 全局配置
   - 平台配置
   - 处理配置
   - Web配置

5. **日志中心**：
   - 系统日志
   - 监控日志
   - 录制日志
   - 处理日志

### 5.2 技术栈

- **前端**：HTML5 + CSS3 + JavaScript (Vue.js/React)
- **后端**：Python (Flask/FastAPI)
- **数据库**：SQLite（轻量级，无需额外安装）
- **API**：RESTful API

## 6. 部署和使用说明

### 6.1 系统要求

- Linux系统：Ubuntu 24.04/Debian 12及以上
- Python 3.8+
- FFmpeg
- Git

### 6.2 安装步骤

1. **安装依赖**：
   ```bash
   sudo apt update
   sudo apt install -y python3 python3-pip ffmpeg git jq
   ```

2. **下载软件**：
   ```bash
   git clone https://github.com/yourname/2233recorder.git /opt/2233recorder
   cd /opt/2233recorder
   ```

3. **安装Python依赖**：
   ```bash
   pip3 install -r requirements.txt
   ```

4. **初始化配置**：
   ```bash
   cp config.example.yaml config.yaml
   cp rooms.example.yaml rooms.yaml
   ```

5. **启动服务**：
   ```bash
   python3 main.py
   # 或使用systemd服务启动
   ```

6. **访问Web后台**：
   ```
   http://your_server_ip:8080
   ```

### 6.3 使用流程

1. 登录Web后台
2. 在"房间管理"中添加需要监控的直播间
3. 配置全局参数和房间参数
4. 系统自动开始监控
5. 直播间开播时自动开始录制
6. 录制完成后自动进行视频处理
7. 在"录制管理"中查看和管理录制文件

## 7. 扩展功能

### 7.1 支持的直播平台

- [x] B站（bilibili）
- [x] 斗鱼（douyu）
- [x] 虎牙（huya）
- [ ] 抖音直播
- [ ] 快手直播
- [ ] YouTube Live

### 7.2 高级功能

- **录制计划**：支持定时录制和预约录制
- **智能剪辑**：自动检测直播精彩片段
- **云存储**：支持录制文件自动上传到云存储（阿里云OSS、腾讯云COS等）
- **多用户管理**：支持多用户权限管理
- **API接口**：提供开放API，方便与其他系统集成
- **容器化部署**：支持Docker容器部署

## 8. 系统架构优势

1. **模块化设计**：各功能模块独立，便于维护和扩展
2. **高度可配置**：通过配置文件和Web界面可灵活调整所有参数
3. **可视化管理**：Web后台操作简单直观
4. **稳定可靠**：基于成熟的开源技术栈
5. **跨平台兼容**：支持主流Linux发行版
6. **易于部署**：提供详细的安装和使用文档

## 9. 总结

2233recorder是一款功能全面、易于使用的Linux直播录播软件，基于成熟的开源技术栈，提供了监控、录制、处理和管理一体化的解决方案。该软件设计思路清晰，架构合理，具有良好的扩展性和兼容性，适合个人用户和小型团队使用。

通过可视化的Web管理界面，用户可以轻松配置和管理录制任务，无需复杂的命令行操作。同时，软件支持多平台、多房间同时录制，满足不同用户的需求。

未来，2233recorder可以进一步扩展支持更多直播平台，添加更多高级功能，如智能剪辑、云存储等，为用户提供更加完善的直播录制解决方案。